"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[364],{4530(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>a,frontMatter:()=>t,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"how-to/troubleshoot","title":"Troubleshoot Common Issues","description":"Connection Issues","source":"@site/docs/how-to/troubleshoot.md","sourceDirName":"how-to","slug":"/how-to/troubleshoot","permalink":"/pr-preview/36/docs/how-to/troubleshoot","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/how-to/troubleshoot.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Deploy to Kubernetes","permalink":"/pr-preview/36/docs/how-to/deploy-kubernetes"},"next":{"title":"Configuration Reference","permalink":"/pr-preview/36/docs/reference/configuration"}}');var r=s(4848),l=s(8453);const t={sidebar_position:5},o="Troubleshoot Common Issues",c={},h=[{value:"Connection Issues",id:"connection-issues",level:2},{value:"&quot;Connection refused&quot; to upstream",id:"connection-refused-to-upstream",level:3},{value:"Requests timeout",id:"requests-timeout",level:3},{value:"Slack Integration",id:"slack-integration",level:2},{value:"Approval messages not appearing",id:"approval-messages-not-appearing",level:3},{value:"Reactions not detected",id:"reactions-not-detected",level:3},{value:"Policy Issues",id:"policy-issues",level:2},{value:"All requests denied",id:"all-requests-denied",level:3},{value:"Policy not reloading",id:"policy-not-reloading",level:3},{value:"Performance Issues",id:"performance-issues",level:2},{value:"High latency",id:"high-latency",level:3},{value:"Memory growing",id:"memory-growing",level:3},{value:"Health Check Failures",id:"health-check-failures",level:2},{value:"Liveness probe failing",id:"liveness-probe-failing",level:3},{value:"Readiness probe failing",id:"readiness-probe-failing",level:3},{value:"Getting Help",id:"getting-help",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"troubleshoot-common-issues",children:"Troubleshoot Common Issues"})}),"\n",(0,r.jsx)(n.h2,{id:"connection-issues",children:"Connection Issues"}),"\n",(0,r.jsx)(n.h3,{id:"connection-refused-to-upstream",children:'"Connection refused" to upstream'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom:"})," Requests fail with upstream connection errors."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Is the upstream reachable?\ncurl http://your-upstream:3000/health\n\n# Check ThoughtGate logs\ndocker logs thoughtgate 2>&1 | grep -i upstream\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Verify ",(0,r.jsx)(n.code,{children:"THOUGHTGATE_UPSTREAM_URL"})," is correct"]}),"\n",(0,r.jsx)(n.li,{children:"In Kubernetes, ensure the service DNS is resolvable"}),"\n",(0,r.jsx)(n.li,{children:"Check network policies aren't blocking traffic"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"requests-timeout",children:"Requests timeout"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom:"})," Requests hang and eventually timeout."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check upstream latency\ntime curl http://your-upstream:3000/health\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Increase ",(0,r.jsx)(n.code,{children:"THOUGHTGATE_REQUEST_TIMEOUT_SECS"})]}),"\n",(0,r.jsx)(n.li,{children:"Check upstream server performance"}),"\n",(0,r.jsx)(n.li,{children:"For approval requests, check Slack connectivity"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"slack-integration",children:"Slack Integration"}),"\n",(0,r.jsx)(n.h3,{id:"approval-messages-not-appearing",children:"Approval messages not appearing"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom:"})," Requests block but no Slack message appears."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Verify token is set\necho $THOUGHTGATE_SLACK_BOT_TOKEN | head -c 10\n\n# Check ThoughtGate logs for Slack errors\ndocker logs thoughtgate 2>&1 | grep -i slack\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Verify the bot token has required scopes: ",(0,r.jsx)(n.code,{children:"chat:write"}),", ",(0,r.jsx)(n.code,{children:"reactions:read"}),", ",(0,r.jsx)(n.code,{children:"channels:history"})]}),"\n",(0,r.jsxs)(n.li,{children:["Ensure the bot is invited to the channel: ",(0,r.jsx)(n.code,{children:"/invite @YourBot"})]}),"\n",(0,r.jsxs)(n.li,{children:["Check the channel name includes ",(0,r.jsx)(n.code,{children:"#"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"reactions-not-detected",children:"Reactions not detected"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom:"})," Messages appear but \ud83d\udc4d/\ud83d\udc4e reactions are ignored."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Verify ",(0,r.jsx)(n.code,{children:"reactions:read"})," scope is granted"]}),"\n",(0,r.jsxs)(n.li,{children:["Check the bot can read channel history (",(0,r.jsx)(n.code,{children:"channels:history"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Re-add the bot to the channel"}),"\n",(0,r.jsx)(n.li,{children:"Verify the reaction is on the correct message (not a thread reply)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"policy-issues",children:"Policy Issues"}),"\n",(0,r.jsx)(n.h3,{id:"all-requests-denied",children:"All requests denied"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom:"}),' Every request returns "Policy denied".']}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Validate Cedar syntax\ncedar validate --policies policy.cedar\n\n# Check ThoughtGate logs\ndocker logs thoughtgate 2>&1 | grep -i policy\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure you have a ",(0,r.jsx)(n.code,{children:"permit"})," rule that matches"]}),"\n",(0,r.jsx)(n.li,{children:"Check for syntax errors in the policy file"}),"\n",(0,r.jsx)(n.li,{children:"Verify the policy file path is correct"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"policy-not-reloading",children:"Policy not reloading"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom:"})," Changes to policy file aren't applied."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"File is readable by ThoughtGate"}),"\n",(0,r.jsx)(n.li,{children:"No syntax errors in the updated policy"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Check logs for "Policy reloaded" or error messages'}),"\n",(0,r.jsx)(n.li,{children:"Restart ThoughtGate if hot reload fails"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"performance-issues",children:"Performance Issues"}),"\n",(0,r.jsx)(n.h3,{id:"high-latency",children:"High latency"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom:"})," Proxy adds significant latency."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Measure overhead\ntime curl -X POST http://localhost:8080 -d \'{"jsonrpc":"2.0","method":"tools/list","id":1}\'\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Enable connection pooling (default)"}),"\n",(0,r.jsx)(n.li,{children:"Check if policy evaluation is slow (complex policies)"}),"\n",(0,r.jsx)(n.li,{children:"Ensure adequate CPU resources"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"memory-growing",children:"Memory growing"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom:"})," Memory usage increases over time."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Monitor memory\ndocker stats thoughtgate\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Check for stale pending approvals (timeout them)"}),"\n",(0,r.jsx)(n.li,{children:"Verify no request body buffering issues"}),"\n",(0,r.jsx)(n.li,{children:"Report if consistently growing (may be a bug)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"health-check-failures",children:"Health Check Failures"}),"\n",(0,r.jsx)(n.h3,{id:"liveness-probe-failing",children:"Liveness probe failing"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom:"})," Kubernetes keeps restarting the pod."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8081/health\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Increase ",(0,r.jsx)(n.code,{children:"initialDelaySeconds"})]}),"\n",(0,r.jsx)(n.li,{children:"Check if the process is actually crashing (logs)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"readiness-probe-failing",children:"Readiness probe failing"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptom:"})," Pod not receiving traffic."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8081/ready\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fix:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Verify upstream is reachable"}),"\n",(0,r.jsx)(n.li,{children:"Check policy file is loaded"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"getting-help",children:"Getting Help"}),"\n",(0,r.jsx)(n.p,{children:"If you're still stuck:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Check the ",(0,r.jsx)(n.a,{href:"https://github.com/thoughtgate/thoughtgate/issues",children:"GitHub Issues"})]}),"\n",(0,r.jsxs)(n.li,{children:["Open a new issue with:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ThoughtGate version"}),"\n",(0,r.jsx)(n.li,{children:"Configuration (redact secrets)"}),"\n",(0,r.jsx)(n.li,{children:"Relevant logs"}),"\n",(0,r.jsx)(n.li,{children:"Steps to reproduce"}),"\n"]}),"\n"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>o});var i=s(6540);const r={},l=i.createContext(r);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);