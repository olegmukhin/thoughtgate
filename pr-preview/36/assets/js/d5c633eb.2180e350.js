"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[178],{5200(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"reference/policy-syntax","title":"Policy Syntax Reference","description":"ThoughtGate uses Cedar for policy definitions.","source":"@site/docs/reference/policy-syntax.md","sourceDirName":"reference","slug":"/reference/policy-syntax","permalink":"/pr-preview/36/docs/reference/policy-syntax","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/reference/policy-syntax.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Configuration Reference","permalink":"/pr-preview/36/docs/reference/configuration"},"next":{"title":"Error Codes Reference","permalink":"/pr-preview/36/docs/reference/error-codes"}}');var l=r(4848),t=r(8453);const s={sidebar_position:2},o="Policy Syntax Reference",c={},a=[{value:"Policy Structure",id:"policy-structure",level:2},{value:"Actions",id:"actions",level:2},{value:"Resource Attributes",id:"resource-attributes",level:2},{value:"Conditions",id:"conditions",level:2},{value:"String Comparisons",id:"string-comparisons",level:3},{value:"Set Membership",id:"set-membership",level:3},{value:"Numeric Comparisons",id:"numeric-comparisons",level:3},{value:"Boolean Logic",id:"boolean-logic",level:3},{value:"Advice (Metadata)",id:"advice-metadata",level:2},{value:"Policy Evaluation Order",id:"policy-evaluation-order",level:2},{value:"Examples",id:"examples",level:2},{value:"Allow everything except admin tools",id:"allow-everything-except-admin-tools",level:3},{value:"Tiered approval thresholds",id:"tiered-approval-thresholds",level:3},{value:"Deny list with exceptions",id:"deny-list-with-exceptions",level:3},{value:"Validation",id:"validation",level:2},{value:"Hot Reload",id:"hot-reload",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"policy-syntax-reference",children:"Policy Syntax Reference"})}),"\n",(0,l.jsxs)(n.p,{children:["ThoughtGate uses ",(0,l.jsx)(n.a,{href:"https://www.cedarpolicy.com/",children:"Cedar"})," for policy definitions."]}),"\n",(0,l.jsx)(n.h2,{id:"policy-structure",children:"Policy Structure"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'permit|forbid(\n    principal,\n    action == Action::"<action>",\n    resource\n) when {\n    <conditions>\n} advice {\n    <metadata>\n};\n'})}),"\n",(0,l.jsx)(n.h2,{id:"actions",children:"Actions"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Action"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'Action::"tools/list"'})}),(0,l.jsx)(n.td,{children:"List available tools"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'Action::"tools/call"'})}),(0,l.jsx)(n.td,{children:"Call a specific tool"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'Action::"prompts/list"'})}),(0,l.jsx)(n.td,{children:"List available prompts"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'Action::"prompts/get"'})}),(0,l.jsx)(n.td,{children:"Get a specific prompt"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'Action::"resources/list"'})}),(0,l.jsx)(n.td,{children:"List available resources"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'Action::"resources/read"'})}),(0,l.jsx)(n.td,{children:"Read a specific resource"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"resource-attributes",children:"Resource Attributes"}),"\n",(0,l.jsxs)(n.p,{children:["For ",(0,l.jsx)(n.code,{children:"tools/call"})," actions:"]}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Attribute"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"resource.tool_name"})}),(0,l.jsx)(n.td,{children:"String"}),(0,l.jsx)(n.td,{children:"Name of the tool being called"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"resource.arguments"})}),(0,l.jsx)(n.td,{children:"Object"}),(0,l.jsx)(n.td,{children:"Tool arguments (JSON)"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"conditions",children:"Conditions"}),"\n",(0,l.jsx)(n.h3,{id:"string-comparisons",children:"String Comparisons"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'when { resource.tool_name == "delete_user" }\nwhen { resource.tool_name != "safe_tool" }\nwhen { resource.tool_name.startsWith("admin_") }\nwhen { resource.tool_name.endsWith("_dangerous") }\nwhen { resource.tool_name.contains("delete") }\n'})}),"\n",(0,l.jsx)(n.h3,{id:"set-membership",children:"Set Membership"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'when { resource.tool_name in ["delete_user", "drop_table", "send_email"] }\n'})}),"\n",(0,l.jsx)(n.h3,{id:"numeric-comparisons",children:"Numeric Comparisons"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:"when { resource.arguments.amount > 10000 }\nwhen { resource.arguments.count >= 5 }\nwhen { resource.arguments.priority < 3 }\n"})}),"\n",(0,l.jsx)(n.h3,{id:"boolean-logic",children:"Boolean Logic"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'when {\n    resource.tool_name == "transfer" &&\n    resource.arguments.amount > 1000\n}\n\nwhen {\n    resource.tool_name == "delete" ||\n    resource.tool_name == "remove"\n}\n\nwhen {\n    !(resource.tool_name in ["safe_tool_1", "safe_tool_2"])\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"advice-metadata",children:"Advice (Metadata)"}),"\n",(0,l.jsx)(n.p,{children:"Advice tells ThoughtGate how to handle matching requests:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'advice {\n    "require_approval": true,\n    "approval_channel": "#high-value-ops",\n    "approval_timeout": "10m"\n}\n'})}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Key"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"require_approval"})}),(0,l.jsx)(n.td,{children:"Boolean"}),(0,l.jsx)(n.td,{children:"Require human approval"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"approval_channel"})}),(0,l.jsx)(n.td,{children:"String"}),(0,l.jsx)(n.td,{children:"Override default Slack channel"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"approval_timeout"})}),(0,l.jsx)(n.td,{children:"String"}),(0,l.jsxs)(n.td,{children:["Override default timeout (e.g., ",(0,l.jsx)(n.code,{children:"5m"}),", ",(0,l.jsx)(n.code,{children:"1h"}),")"]})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"policy-evaluation-order",children:"Policy Evaluation Order"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Policies are evaluated in file order"}),"\n",(0,l.jsxs)(n.li,{children:["First matching ",(0,l.jsx)(n.code,{children:"forbid"})," denies the request"]}),"\n",(0,l.jsxs)(n.li,{children:["First matching ",(0,l.jsx)(n.code,{children:"permit"})," allows (with advice)"]}),"\n",(0,l.jsx)(n.li,{children:"No match = implicit deny"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,l.jsx)(n.h3,{id:"allow-everything-except-admin-tools",children:"Allow everything except admin tools"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'forbid(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name.startsWith("admin_")\n};\n\npermit(\n    principal,\n    action,\n    resource\n);\n'})}),"\n",(0,l.jsx)(n.h3,{id:"tiered-approval-thresholds",children:"Tiered approval thresholds"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'// High-value: requires approval\npermit(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name == "transfer_funds" &&\n    resource.arguments.amount > 10000\n} advice {\n    "require_approval": true,\n    "approval_channel": "#finance-approvals"\n};\n\n// Medium-value: just log\npermit(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name == "transfer_funds" &&\n    resource.arguments.amount > 1000\n};\n\n// Low-value: allow\npermit(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name == "transfer_funds"\n};\n'})}),"\n",(0,l.jsx)(n.h3,{id:"deny-list-with-exceptions",children:"Deny list with exceptions"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'// Allow safe operations explicitly\npermit(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name in ["get_balance", "list_accounts"]\n};\n\n// Deny all other tools/call\nforbid(\n    principal,\n    action == Action::"tools/call",\n    resource\n);\n\n// Allow tools/list\npermit(\n    principal,\n    action == Action::"tools/list",\n    resource\n);\n'})}),"\n",(0,l.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,l.jsx)(n.p,{children:"Validate policies before deployment:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"cedar validate --policies policy.cedar\n"})}),"\n",(0,l.jsx)(n.h2,{id:"hot-reload",children:"Hot Reload"}),"\n",(0,l.jsx)(n.p,{children:"ThoughtGate watches the policy file and reloads on changes. No restart required."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>s,x:()=>o});var i=r(6540);const l={},t=i.createContext(l);function s(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);