"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[759],{168(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"explanation/traffic-tiers","title":"Traffic Tiers","description":"ThoughtGate classifies all traffic into three tiers based on policy evaluation. Each tier has different handling characteristics.","source":"@site/docs/explanation/traffic-tiers.md","sourceDirName":"explanation","slug":"/explanation/traffic-tiers","permalink":"/pr-preview/36/docs/explanation/traffic-tiers","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/explanation/traffic-tiers.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Architecture","permalink":"/pr-preview/36/docs/explanation/architecture"},"next":{"title":"Security Model","permalink":"/pr-preview/36/docs/explanation/security-model"}}');var s=i(4848),t=i(8453);const l={sidebar_position:3},c="Traffic Tiers",a={},d=[{value:"Overview",id:"overview",level:2},{value:"Green Tier",id:"green-tier",level:2},{value:"Characteristics",id:"characteristics",level:3},{value:"Typical Use Cases",id:"typical-use-cases",level:3},{value:"Policy Example",id:"policy-example",level:3},{value:"Amber Tier",id:"amber-tier",level:2},{value:"Characteristics",id:"characteristics-1",level:3},{value:"Typical Use Cases",id:"typical-use-cases-1",level:3},{value:"Policy Example",id:"policy-example-1",level:3},{value:"Red Tier",id:"red-tier",level:2},{value:"Characteristics",id:"characteristics-2",level:3},{value:"Deny Path",id:"deny-path",level:4},{value:"Approval Path",id:"approval-path",level:4},{value:"Typical Use Cases",id:"typical-use-cases-2",level:3},{value:"Policy Examples",id:"policy-examples",level:3},{value:"Tier Selection Logic",id:"tier-selection-logic",level:2},{value:"Choosing the Right Tier",id:"choosing-the-right-tier",level:2},{value:"Use Green When",id:"use-green-when",level:3},{value:"Use Amber When",id:"use-amber-when",level:3},{value:"Use Red (Deny) When",id:"use-red-deny-when",level:3},{value:"Use Red (Approval) When",id:"use-red-approval-when",level:3},{value:"Performance Implications",id:"performance-implications",level:2},{value:"Monitoring Tiers",id:"monitoring-tiers",level:2}];function o(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"traffic-tiers",children:"Traffic Tiers"})}),"\n",(0,s.jsx)(n.p,{children:"ThoughtGate classifies all traffic into three tiers based on policy evaluation. Each tier has different handling characteristics."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Tier"}),(0,s.jsx)(n.th,{children:"Trust Level"}),(0,s.jsx)(n.th,{children:"Behavior"}),(0,s.jsx)(n.th,{children:"Latency"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Green"})}),(0,s.jsx)(n.td,{children:"High"}),(0,s.jsx)(n.td,{children:"Forward immediately"}),(0,s.jsx)(n.td,{children:"< 2 ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Amber"})}),(0,s.jsx)(n.td,{children:"Medium"}),(0,s.jsx)(n.td,{children:"Inspect, then forward"}),(0,s.jsx)(n.td,{children:"< 5 ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Red"})}),(0,s.jsx)(n.td,{children:"Low"}),(0,s.jsx)(n.td,{children:"Deny or require approval"}),(0,s.jsx)(n.td,{children:"Variable"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"green-tier",children:"Green Tier"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," Fast path for trusted, low-risk operations."]}),"\n",(0,s.jsx)(n.h3,{id:"characteristics",children:"Characteristics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Minimal processing"}),"\n",(0,s.jsx)(n.li,{children:"No content inspection"}),"\n",(0,s.jsx)(n.li,{children:"Direct forwarding to upstream"}),"\n",(0,s.jsx)(n.li,{children:"Responses passed through unchanged"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"typical-use-cases",children:"Typical Use Cases"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"tools/list"})," \u2014 Listing available tools"]}),"\n",(0,s.jsx)(n.li,{children:"Read-only queries"}),"\n",(0,s.jsx)(n.li,{children:"Idempotent operations"}),"\n",(0,s.jsx)(n.li,{children:"Internal/trusted tool calls"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"policy-example",children:"Policy Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cedar",children:'permit(\n    principal,\n    action == Action::"tools/list",\n    resource\n);\n\npermit(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name in ["get_balance", "list_items", "search"]\n};\n'})}),"\n",(0,s.jsx)(n.h2,{id:"amber-tier",children:"Amber Tier"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," Balanced path for operations that need inspection but not approval."]}),"\n",(0,s.jsx)(n.h3,{id:"characteristics-1",children:"Characteristics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Request/response buffering"}),"\n",(0,s.jsx)(n.li,{children:"Content inspection (PII detection, schema validation)"}),"\n",(0,s.jsx)(n.li,{children:"Transformation possible"}),"\n",(0,s.jsx)(n.li,{children:"Slightly higher latency"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"typical-use-cases-1",children:"Typical Use Cases"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Responses containing user data"}),"\n",(0,s.jsx)(n.li,{children:"Operations with compliance requirements"}),"\n",(0,s.jsx)(n.li,{children:"Logging/audit requirements"}),"\n",(0,s.jsx)(n.li,{children:"Data transformation needs"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"policy-example-1",children:"Policy Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cedar",children:'permit(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name == "get_user_profile"\n} advice {\n    "inspect": true,\n    "redact_pii": true\n};\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Amber tier inspection is planned for v0.2. In v0.1, Amber tier requests are treated as Green tier."})}),"\n",(0,s.jsx)(n.h2,{id:"red-tier",children:"Red Tier"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," High-scrutiny path for sensitive operations."]}),"\n",(0,s.jsx)(n.h3,{id:"characteristics-2",children:"Characteristics"}),"\n",(0,s.jsx)(n.p,{children:"Red tier has two sub-paths:"}),"\n",(0,s.jsx)(n.h4,{id:"deny-path",children:"Deny Path"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Immediate rejection"}),"\n",(0,s.jsx)(n.li,{children:"No upstream communication"}),"\n",(0,s.jsx)(n.li,{children:"Clear error response"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"approval-path",children:"Approval Path"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Request blocks until human approval"}),"\n",(0,s.jsx)(n.li,{children:"Message posted to Slack"}),"\n",(0,s.jsx)(n.li,{children:"Human reacts with \ud83d\udc4d (approve) or \ud83d\udc4e (reject)"}),"\n",(0,s.jsx)(n.li,{children:"On approval: forwards to upstream"}),"\n",(0,s.jsx)(n.li,{children:"On rejection: returns error"}),"\n",(0,s.jsx)(n.li,{children:"On timeout: returns error"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"typical-use-cases-2",children:"Typical Use Cases"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Destructive operations (delete, drop, remove)"}),"\n",(0,s.jsx)(n.li,{children:"Financial transactions"}),"\n",(0,s.jsx)(n.li,{children:"PII modifications"}),"\n",(0,s.jsx)(n.li,{children:"Privilege escalation"}),"\n",(0,s.jsx)(n.li,{children:"Administrative actions"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"policy-examples",children:"Policy Examples"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Deny outright:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cedar",children:'forbid(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name.startsWith("admin_")\n};\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Require approval:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cedar",children:'permit(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name in ["delete_user", "transfer_funds"]\n} advice {\n    "require_approval": true\n};\n'})}),"\n",(0,s.jsx)(n.h2,{id:"tier-selection-logic",children:"Tier Selection Logic"}),"\n",(0,s.jsx)(n.p,{children:"Policy evaluation determines the tier:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  POLICY EVALUATION                       \u2502\n\u2502                                                         \u2502\n\u2502  1. Evaluate all policies in order                      \u2502\n\u2502  2. First matching forbid \u2192 RED (deny)                  \u2502\n\u2502  3. First matching permit with require_approval         \u2502\n\u2502     \u2192 RED (approval)                                    \u2502\n\u2502  4. First matching permit with inspect                  \u2502\n\u2502     \u2192 AMBER                                             \u2502\n\u2502  5. First matching permit (no advice)                   \u2502\n\u2502     \u2192 GREEN                                             \u2502\n\u2502  6. No match \u2192 RED (deny) [fail-safe]                  \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h2,{id:"choosing-the-right-tier",children:"Choosing the Right Tier"}),"\n",(0,s.jsx)(n.h3,{id:"use-green-when",children:"Use Green When"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Operation is read-only"}),"\n",(0,s.jsx)(n.li,{children:"Failure is easily recoverable"}),"\n",(0,s.jsx)(n.li,{children:"No sensitive data involved"}),"\n",(0,s.jsx)(n.li,{children:"High-frequency operation"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"use-amber-when",children:"Use Amber When"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Need to inspect content"}),"\n",(0,s.jsx)(n.li,{children:"Compliance/audit requirements"}),"\n",(0,s.jsx)(n.li,{children:"Data transformation needed"}),"\n",(0,s.jsx)(n.li,{children:"Moderate sensitivity"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"use-red-deny-when",children:"Use Red (Deny) When"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Operation should never be allowed"}),"\n",(0,s.jsx)(n.li,{children:"Clear policy violation"}),"\n",(0,s.jsx)(n.li,{children:"Known attack pattern"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"use-red-approval-when",children:"Use Red (Approval) When"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Operation is legitimate but sensitive"}),"\n",(0,s.jsx)(n.li,{children:"Human judgment required"}),"\n",(0,s.jsx)(n.li,{children:"Irreversible consequences"}),"\n",(0,s.jsx)(n.li,{children:"High-value transactions"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"performance-implications",children:"Performance Implications"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Tier"}),(0,s.jsx)(n.th,{children:"p50 Latency"}),(0,s.jsx)(n.th,{children:"p99 Latency"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Green"}),(0,s.jsx)(n.td,{children:"1-2 ms"}),(0,s.jsx)(n.td,{children:"5 ms"}),(0,s.jsx)(n.td,{children:"Network bound"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Amber"}),(0,s.jsx)(n.td,{children:"3-5 ms"}),(0,s.jsx)(n.td,{children:"15 ms"}),(0,s.jsx)(n.td,{children:"Inspection bound"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Red (deny)"}),(0,s.jsx)(n.td,{children:"< 1 ms"}),(0,s.jsx)(n.td,{children:"2 ms"}),(0,s.jsx)(n.td,{children:"No upstream call"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Red (approve)"}),(0,s.jsx)(n.td,{children:"10s-5m"}),(0,s.jsx)(n.td,{children:"Timeout"}),(0,s.jsx)(n.td,{children:"Human bound"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"monitoring-tiers",children:"Monitoring Tiers"}),"\n",(0,s.jsx)(n.p,{children:"Prometheus metrics by tier:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-prometheus",children:'thoughtgate_requests_total{tier="green"}\nthoughtgate_requests_total{tier="amber"}\nthoughtgate_requests_total{tier="red"}\n\nthoughtgate_request_duration_seconds{tier="green"}\nthoughtgate_request_duration_seconds{tier="amber"}\nthoughtgate_request_duration_seconds{tier="red"}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Healthy distribution varies by use case, but typical patterns:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"High automation:"})," 90% green, 8% amber, 2% red"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"High oversight:"})," 60% green, 20% amber, 20% red"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Strict governance:"})," 40% green, 30% amber, 30% red"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>c});var r=i(6540);const s={},t=r.createContext(s);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);