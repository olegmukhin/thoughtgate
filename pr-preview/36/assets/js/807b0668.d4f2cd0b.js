"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[888],{7770(e,t,r){r.r(t),r.d(t,{assets:()=>i,contentTitle:()=>a,default:()=>p,frontMatter:()=>l,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"tutorials/first-proxy","title":"Your First ThoughtGate Proxy","description":"In this tutorial, you\'ll set up ThoughtGate to proxy requests between an AI agent and an MCP server, with a simple policy that requires approval for destructive operations.","source":"@site/docs/tutorials/first-proxy.md","sourceDirName":"tutorials","slug":"/tutorials/first-proxy","permalink":"/pr-preview/36/docs/tutorials/first-proxy","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/tutorials/first-proxy.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Introduction","permalink":"/pr-preview/36/docs/"},"next":{"title":"Quickstart","permalink":"/pr-preview/36/docs/how-to/quickstart"}}');var s=r(4848),o=r(8453);const l={sidebar_position:1},a="Your First ThoughtGate Proxy",i={},c=[{value:"What You&#39;ll Learn",id:"what-youll-learn",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Build ThoughtGate",id:"step-1-build-thoughtgate",level:2},{value:"Step 2: Start a Mock MCP Server",id:"step-2-start-a-mock-mcp-server",level:2},{value:"Step 3: Write a Cedar Policy",id:"step-3-write-a-cedar-policy",level:2},{value:"Step 4: Configure Slack Integration",id:"step-4-configure-slack-integration",level:2},{value:"Step 5: Start ThoughtGate",id:"step-5-start-thoughtgate",level:2},{value:"Step 6: Test the Proxy",id:"step-6-test-the-proxy",level:2},{value:"Step 7: Trigger an Approval",id:"step-7-trigger-an-approval",level:2},{value:"Step 8: Verify Health",id:"step-8-verify-health",level:2},{value:"What&#39;s Next?",id:"whats-next",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"your-first-thoughtgate-proxy",children:"Your First ThoughtGate Proxy"})}),"\n",(0,s.jsx)(t.p,{children:"In this tutorial, you'll set up ThoughtGate to proxy requests between an AI agent and an MCP server, with a simple policy that requires approval for destructive operations."}),"\n",(0,s.jsx)(t.h2,{id:"what-youll-learn",children:"What You'll Learn"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"How to run ThoughtGate as a proxy"}),"\n",(0,s.jsx)(t.li,{children:"How to write a basic Cedar policy"}),"\n",(0,s.jsx)(t.li,{children:"How to configure Slack approvals"}),"\n",(0,s.jsx)(t.li,{children:"How to test the approval workflow"}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Rust 1.75+ installed"}),"\n",(0,s.jsx)(t.li,{children:"An MCP server running (or use the mock server)"}),"\n",(0,s.jsx)(t.li,{children:"A Slack workspace with bot token (for approvals)"}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"step-1-build-thoughtgate",children:"Step 1: Build ThoughtGate"}),"\n",(0,s.jsx)(t.p,{children:"Clone the repository and build the release binary:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"git clone https://github.com/thoughtgate/thoughtgate\ncd thoughtgate\ncargo build --release\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The binary will be at ",(0,s.jsx)(t.code,{children:"target/release/thoughtgate"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"step-2-start-a-mock-mcp-server",children:"Step 2: Start a Mock MCP Server"}),"\n",(0,s.jsx)(t.p,{children:"For testing, ThoughtGate includes a mock MCP server:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"cargo build --release --features mock\n./target/release/mock_llm --port 3000\n"})}),"\n",(0,s.jsx)(t.p,{children:"This server responds to MCP tool calls with mock data."}),"\n",(0,s.jsx)(t.h2,{id:"step-3-write-a-cedar-policy",children:"Step 3: Write a Cedar Policy"}),"\n",(0,s.jsxs)(t.p,{children:["Create a file ",(0,s.jsx)(t.code,{children:"policy.cedar"})," with a simple policy:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-cedar",children:'// Allow all tools/list requests\npermit(\n    principal,\n    action == Action::"tools/list",\n    resource\n);\n\n// Allow tools/call but require approval for destructive operations\npermit(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name in ["delete_user", "drop_table", "send_email"]\n} advice {\n    "require_approval": true\n};\n\n// Allow all other tools/call requests\npermit(\n    principal,\n    action == Action::"tools/call",\n    resource\n);\n'})}),"\n",(0,s.jsx)(t.h2,{id:"step-4-configure-slack-integration",children:"Step 4: Configure Slack Integration"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Create a Slack app at ",(0,s.jsx)(t.a,{href:"https://api.slack.com/apps",children:"api.slack.com/apps"})]}),"\n",(0,s.jsxs)(t.li,{children:["Add Bot Token Scopes: ",(0,s.jsx)(t.code,{children:"chat:write"}),", ",(0,s.jsx)(t.code,{children:"reactions:read"}),", ",(0,s.jsx)(t.code,{children:"channels:history"})]}),"\n",(0,s.jsx)(t.li,{children:"Install to your workspace"}),"\n",(0,s.jsx)(t.li,{children:"Copy the Bot OAuth Token"}),"\n",(0,s.jsxs)(t.li,{children:["Create a channel for approvals (e.g., ",(0,s.jsx)(t.code,{children:"#thoughtgate-approvals"}),")"]}),"\n",(0,s.jsxs)(t.li,{children:["Invite the bot: ",(0,s.jsx)(t.code,{children:"/invite @YourBotName"})]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"step-5-start-thoughtgate",children:"Step 5: Start ThoughtGate"}),"\n",(0,s.jsx)(t.p,{children:"Set environment variables and start the proxy:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'export THOUGHTGATE_UPSTREAM_URL=http://localhost:3000\nexport THOUGHTGATE_OUTBOUND_PORT=8080\nexport THOUGHTGATE_ADMIN_PORT=8081\nexport THOUGHTGATE_CEDAR_POLICY_PATH=./policy.cedar\nexport THOUGHTGATE_SLACK_BOT_TOKEN=xoxb-your-token\nexport THOUGHTGATE_SLACK_CHANNEL="#thoughtgate-approvals"\n\n./target/release/thoughtgate\n'})}),"\n",(0,s.jsx)(t.p,{children:"You should see:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"ThoughtGate listening on 0.0.0.0:8080\nAdmin server on 0.0.0.0:8081\nUpstream: http://localhost:3000\n"})}),"\n",(0,s.jsx)(t.h2,{id:"step-6-test-the-proxy",children:"Step 6: Test the Proxy"}),"\n",(0,s.jsx)(t.p,{children:"Send a tools/list request (should pass through):"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'curl -X POST http://localhost:8080 \\\n  -H "Content-Type: application/json" \\\n  -d \'{"jsonrpc": "2.0", "method": "tools/list", "id": 1}\'\n'})}),"\n",(0,s.jsx)(t.p,{children:"Send a safe tools/call request (should pass through):"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'curl -X POST http://localhost:8080 \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "tools/call",\n    "params": {"name": "get_weather", "arguments": {"city": "London"}},\n    "id": 2\n  }\'\n'})}),"\n",(0,s.jsx)(t.h2,{id:"step-7-trigger-an-approval",children:"Step 7: Trigger an Approval"}),"\n",(0,s.jsx)(t.p,{children:"Send a destructive tools/call request:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'curl -X POST http://localhost:8080 \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "tools/call",\n    "params": {"name": "delete_user", "arguments": {"user_id": "12345"}},\n    "id": 3\n  }\'\n'})}),"\n",(0,s.jsx)(t.p,{children:"This request will block while waiting for approval."}),"\n",(0,s.jsx)(t.p,{children:"Check your Slack channel \u2014 you should see a message like:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:'\ud83d\udd14 Approval Required\n\nTool: delete_user\nArguments: {"user_id": "12345"}\n\nReact \ud83d\udc4d to approve or \ud83d\udc4e to reject\n'})}),"\n",(0,s.jsx)(t.p,{children:"React with \ud83d\udc4d to approve the request. The curl command will complete with the response."}),"\n",(0,s.jsx)(t.h2,{id:"step-8-verify-health",children:"Step 8: Verify Health"}),"\n",(0,s.jsx)(t.p,{children:"Check the health endpoints:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"curl http://localhost:8081/health\ncurl http://localhost:8081/ready\n"})}),"\n",(0,s.jsx)(t.h2,{id:"whats-next",children:"What's Next?"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Learn how to ",(0,s.jsx)(t.a,{href:"/docs/how-to/write-policies",children:"write more complex policies"})]}),"\n",(0,s.jsxs)(t.li,{children:["Understand ",(0,s.jsx)(t.a,{href:"/docs/explanation/traffic-tiers",children:"traffic tiers"})," in depth"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"/docs/how-to/deploy-kubernetes",children:"Deploy to Kubernetes"})," for production"]}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453(e,t,r){r.d(t,{R:()=>l,x:()=>a});var n=r(6540);const s={},o=n.createContext(s);function l(e){const t=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);