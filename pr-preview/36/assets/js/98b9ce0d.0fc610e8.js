"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[79],{5484(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>p,frontMatter:()=>t,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"how-to/write-policies","title":"Write Cedar Policies","description":"This guide shows you how to write Cedar policies to control which MCP tool calls require approval.","source":"@site/docs/how-to/write-policies.md","sourceDirName":"how-to","slug":"/how-to/write-policies","permalink":"/pr-preview/36/docs/how-to/write-policies","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/how-to/write-policies.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Install ThoughtGate","permalink":"/pr-preview/36/docs/how-to/install"},"next":{"title":"Deploy to Kubernetes","permalink":"/pr-preview/36/docs/how-to/deploy-kubernetes"}}');var l=i(4848),r=i(8453);const t={sidebar_position:3},s="Write Cedar Policies",a={},c=[{value:"Basic Structure",id:"basic-structure",level:2},{value:"Allow All Tool Listings",id:"allow-all-tool-listings",level:2},{value:"Require Approval for Specific Tools",id:"require-approval-for-specific-tools",level:2},{value:"Deny Specific Tools",id:"deny-specific-tools",level:2},{value:"Conditional Approval Based on Arguments",id:"conditional-approval-based-on-arguments",level:2},{value:"Multiple Policies",id:"multiple-policies",level:2},{value:"Testing Policies",id:"testing-policies",level:2},{value:"Hot Reloading",id:"hot-reloading",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"write-cedar-policies",children:"Write Cedar Policies"})}),"\n",(0,l.jsx)(n.p,{children:"This guide shows you how to write Cedar policies to control which MCP tool calls require approval."}),"\n",(0,l.jsx)(n.h2,{id:"basic-structure",children:"Basic Structure"}),"\n",(0,l.jsx)(n.p,{children:"A Cedar policy has three parts:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'permit(\n    principal,           // Who is making the request\n    action == Action::"tools/call",  // What action\n    resource             // The tool being called\n) when {\n    // Conditions\n} advice {\n    // Metadata for ThoughtGate\n};\n'})}),"\n",(0,l.jsx)(n.h2,{id:"allow-all-tool-listings",children:"Allow All Tool Listings"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'permit(\n    principal,\n    action == Action::"tools/list",\n    resource\n);\n'})}),"\n",(0,l.jsx)(n.h2,{id:"require-approval-for-specific-tools",children:"Require Approval for Specific Tools"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'permit(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name in ["delete_user", "drop_table", "send_email"]\n} advice {\n    "require_approval": true,\n    "approval_channel": "#sensitive-ops"\n};\n'})}),"\n",(0,l.jsx)(n.h2,{id:"deny-specific-tools",children:"Deny Specific Tools"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'forbid(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name == "admin_console"\n};\n'})}),"\n",(0,l.jsx)(n.h2,{id:"conditional-approval-based-on-arguments",children:"Conditional Approval Based on Arguments"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'permit(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name == "transfer_funds" &&\n    resource.arguments.amount > 10000\n} advice {\n    "require_approval": true,\n    "approval_timeout": "10m"\n};\n'})}),"\n",(0,l.jsx)(n.h2,{id:"multiple-policies",children:"Multiple Policies"}),"\n",(0,l.jsx)(n.p,{children:"Policies are evaluated in order. The first matching policy wins."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cedar",children:'// 1. Always deny admin tools\nforbid(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name.startsWith("admin_")\n};\n\n// 2. Require approval for destructive operations\npermit(\n    principal,\n    action == Action::"tools/call",\n    resource\n) when {\n    resource.tool_name in ["delete", "drop", "remove"]\n} advice {\n    "require_approval": true\n};\n\n// 3. Allow everything else\npermit(\n    principal,\n    action == Action::"tools/call",\n    resource\n);\n'})}),"\n",(0,l.jsx)(n.h2,{id:"testing-policies",children:"Testing Policies"}),"\n",(0,l.jsx)(n.p,{children:"Use the Cedar CLI to validate syntax:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"cedar validate --schema schema.cedarschema --policies policy.cedar\n"})}),"\n",(0,l.jsx)(n.h2,{id:"hot-reloading",children:"Hot Reloading"}),"\n",(0,l.jsx)(n.p,{children:"ThoughtGate watches the policy file for changes. Updates are applied without restart."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Modify policy.cedar\n# ThoughtGate logs: "Policy reloaded successfully"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["See the full ",(0,l.jsx)(n.a,{href:"/docs/reference/policy-syntax",children:"Policy Syntax Reference"})]}),"\n",(0,l.jsxs)(n.li,{children:["Understand ",(0,l.jsx)(n.a,{href:"/docs/explanation/traffic-tiers",children:"Traffic Tiers"})]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453(e,n,i){i.d(n,{R:()=>t,x:()=>s});var o=i(6540);const l={},r=o.createContext(l);function t(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);