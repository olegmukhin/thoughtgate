"use strict";(globalThis.webpackChunkthoughtgate_docs=globalThis.webpackChunkthoughtgate_docs||[]).push([[810],{8453(e,n,r){r.d(n,{R:()=>t,x:()=>a});var i=r(6540);const s={},l=i.createContext(s);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(l.Provider,{value:n},e.children)}},9477(e,n,r){r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"explanation/architecture","title":"Architecture","description":"ThoughtGate is a transparent proxy that sits between AI agents and MCP servers.","source":"@site/docs/explanation/architecture.md","sourceDirName":"explanation","slug":"/explanation/architecture","permalink":"/pr-preview/36/docs/explanation/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/thoughtgate/thoughtgate/tree/main/website/docs/explanation/architecture.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Why ThoughtGate","permalink":"/pr-preview/36/docs/explanation/why-thoughtgate"},"next":{"title":"Traffic Tiers","permalink":"/pr-preview/36/docs/explanation/traffic-tiers"}}');var s=r(4848),l=r(8453);const t={sidebar_position:2},a="Architecture",d={},c=[{value:"High-Level Overview",id:"high-level-overview",level:2},{value:"Components",id:"components",level:2},{value:"1. Transport Layer",id:"1-transport-layer",level:3},{value:"2. Policy Engine",id:"2-policy-engine",level:3},{value:"3. Governance Layer",id:"3-governance-layer",level:3},{value:"4. Admin Server",id:"4-admin-server",level:3},{value:"Request Flow",id:"request-flow",level:2},{value:"Port Model",id:"port-model",level:2},{value:"State Management",id:"state-management",level:2},{value:"v0.1: In-Memory",id:"v01-in-memory",level:3},{value:"Future: Persistent State",id:"future-persistent-state",level:3},{value:"Deployment Model",id:"deployment-model",level:2},{value:"Performance Characteristics",id:"performance-characteristics",level:2},{value:"Failure Modes",id:"failure-modes",level:2},{value:"Upstream Unavailable",id:"upstream-unavailable",level:3},{value:"Policy Error",id:"policy-error",level:3},{value:"Slack Unavailable",id:"slack-unavailable",level:3},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,s.jsx)(n.p,{children:"ThoughtGate is a transparent proxy that sits between AI agents and MCP servers."}),"\n",(0,s.jsx)(n.h2,{id:"high-level-overview",children:"High-Level Overview"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  AI Agent   \u2502\u2500\u2500\u2500\u2500\u25b6\u2502           ThoughtGate               \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  MCP Server \u2502\n\u2502  (Claude,   \u2502\u25c0\u2500\u2500\u2500\u2500\u2502                                     \u2502\u25c0\u2500\u2500\u2500\u2500\u2502  (Tools)    \u2502\n\u2502   GPT, etc) \u2502     \u2502  Outbound: 8080    Admin: 8081      \u2502     \u2502             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h2,{id:"components",children:"Components"}),"\n",(0,s.jsx)(n.h3,{id:"1-transport-layer",children:"1. Transport Layer"}),"\n",(0,s.jsx)(n.p,{children:"Handles JSON-RPC 2.0 message parsing and routing:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Parses incoming MCP requests"}),"\n",(0,s.jsx)(n.li,{children:"Preserves request ID types (string, number, null)"}),"\n",(0,s.jsx)(n.li,{children:"Routes responses back to clients"}),"\n",(0,s.jsx)(n.li,{children:"Manages connection pooling to upstream"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-policy-engine",children:"2. Policy Engine"}),"\n",(0,s.jsx)(n.p,{children:"Evaluates requests against Cedar policies:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Loads policies from file"}),"\n",(0,s.jsx)(n.li,{children:"Watches for policy changes (hot reload)"}),"\n",(0,s.jsx)(n.li,{children:"Returns tier classification (Green, Amber, Red)"}),"\n",(0,s.jsx)(n.li,{children:"Extracts advice metadata for approval routing"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-governance-layer",children:"3. Governance Layer"}),"\n",(0,s.jsx)(n.p,{children:"Manages approval workflows:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Creates approval tasks for Red-tier requests"}),"\n",(0,s.jsx)(n.li,{children:"Posts messages to Slack"}),"\n",(0,s.jsx)(n.li,{children:"Polls for reactions (\ud83d\udc4d/\ud83d\udc4e)"}),"\n",(0,s.jsx)(n.li,{children:"Handles timeouts and cancellation"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"4-admin-server",children:"4. Admin Server"}),"\n",(0,s.jsx)(n.p,{children:"Provides operational endpoints:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/health"})," \u2014 Liveness probe"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/ready"})," \u2014 Readiness probe"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/metrics"})," \u2014 Prometheus metrics"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"request-flow",children:"Request Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502               THOUGHTGATE                 \u2502\n                    \u2502                                          \u2502\n  Request \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  1. Parse JSON-RPC                       \u2502\n                    \u2502  2. Evaluate Cedar Policy                \u2502\n                    \u2502  3. Classify Tier                        \u2502\n                    \u2502                                          \u2502\n                    \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n                    \u2502     \u2502         TIER ROUTER             \u2502  \u2502\n                    \u2502     \u2502                                 \u2502  \u2502\n                    \u2502     \u2502  Green \u2500\u2500\u25b6 Forward to upstream  \u2502\u2500\u2500\u253c\u2500\u2500\u25b6 Upstream\n                    \u2502     \u2502  Amber \u2500\u2500\u25b6 Inspect, then fwd    \u2502  \u2502\n                    \u2502     \u2502  Red \u2500\u2500\u2500\u2500\u25b6 Approval workflow    \u2502  \u2502\n                    \u2502     \u2502         \u2500\u2500\u25b6 or Deny             \u2502  \u2502\n                    \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n                    \u2502                                          \u2502\n  Response \u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  4. Return upstream response or error   \u2502\n                    \u2502                                          \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h2,{id:"port-model",children:"Port Model"}),"\n",(0,s.jsx)(n.p,{children:"ThoughtGate uses a two-port model:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Port"}),(0,s.jsx)(n.th,{children:"Name"}),(0,s.jsx)(n.th,{children:"Purpose"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"8080"}),(0,s.jsx)(n.td,{children:"Outbound"}),(0,s.jsx)(n.td,{children:"Proxy traffic (agent \u2192 upstream)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"8081"}),(0,s.jsx)(n.td,{children:"Admin"}),(0,s.jsx)(n.td,{children:"Health checks, metrics"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"This separation ensures health checks don't interfere with proxy traffic and allows different security policies per port."}),"\n",(0,s.jsx)(n.h2,{id:"state-management",children:"State Management"}),"\n",(0,s.jsx)(n.h3,{id:"v01-in-memory",children:"v0.1: In-Memory"}),"\n",(0,s.jsx)(n.p,{children:"All state is held in memory:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Pending approval tasks"}),"\n",(0,s.jsx)(n.li,{children:"Connection pools"}),"\n",(0,s.jsx)(n.li,{children:"Policy cache"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implication:"})," Pending approvals are lost on restart."]}),"\n",(0,s.jsx)(n.h3,{id:"future-persistent-state",children:"Future: Persistent State"}),"\n",(0,s.jsx)(n.p,{children:"Planned for v0.2:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Redis-backed task storage"}),"\n",(0,s.jsx)(n.li,{children:"Approval state survives restarts"}),"\n",(0,s.jsx)(n.li,{children:"Multi-instance coordination"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"deployment-model",children:"Deployment Model"}),"\n",(0,s.jsxs)(n.p,{children:["ThoughtGate is designed as a ",(0,s.jsx)(n.strong,{children:"sidecar"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spec:\n  containers:\n    - name: agent          # Your AI agent\n    - name: thoughtgate    # Sidecar proxy\n"})}),"\n",(0,s.jsx)(n.p,{children:"Benefits:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"No network hop (localhost)"}),"\n",(0,s.jsx)(n.li,{children:"Per-agent isolation"}),"\n",(0,s.jsx)(n.li,{children:"Independent scaling"}),"\n",(0,s.jsx)(n.li,{children:"Simple security model"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"performance-characteristics",children:"Performance Characteristics"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Path"}),(0,s.jsx)(n.th,{children:"Latency Overhead"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Green"}),(0,s.jsx)(n.td,{children:"< 2 ms"}),(0,s.jsx)(n.td,{children:"Policy eval + forward"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Amber"}),(0,s.jsx)(n.td,{children:"< 5 ms"}),(0,s.jsx)(n.td,{children:"Policy eval + inspect + forward"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Red (deny)"}),(0,s.jsx)(n.td,{children:"< 1 ms"}),(0,s.jsx)(n.td,{children:"Policy eval + error"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Red (approve)"}),(0,s.jsx)(n.td,{children:"Seconds to minutes"}),(0,s.jsx)(n.td,{children:"Waiting for human"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"failure-modes",children:"Failure Modes"}),"\n",(0,s.jsx)(n.h3,{id:"upstream-unavailable",children:"Upstream Unavailable"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Request fails with ",(0,s.jsx)(n.code,{children:"-32000 UpstreamConnectionFailed"})]}),"\n",(0,s.jsx)(n.li,{children:"Readiness probe fails"}),"\n",(0,s.jsx)(n.li,{children:"Agent receives clear error"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"policy-error",children:"Policy Error"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Request denied (fail-safe)"}),"\n",(0,s.jsx)(n.li,{children:"Logged as error"}),"\n",(0,s.jsx)(n.li,{children:"Operator alerted via metrics"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"slack-unavailable",children:"Slack Unavailable"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Approval requests fail"}),"\n",(0,s.jsx)(n.li,{children:"Falls back to timeout behavior"}),"\n",(0,s.jsx)(n.li,{children:"Logged as error"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Understand ",(0,s.jsx)(n.a,{href:"/docs/explanation/traffic-tiers",children:"Traffic Tiers"})," in depth"]}),"\n",(0,s.jsxs)(n.li,{children:["Learn about the ",(0,s.jsx)(n.a,{href:"/docs/explanation/security-model",children:"Security Model"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);